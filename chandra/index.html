<html>
  <head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Chandra App</title>
    <link href="./Chandra.css" rel="stylesheet">
    <script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.2.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-curve-component/dist/aframe-curve-component.min.js"></script>
    <script src="https://rawgit.com/protyze/aframe-alongpath-component/master/dist/aframe-alongpath-component.min.js"></script>
    <script src="https://unpkg.com/aframe-render-order-component@1.1.0/dist/aframe-render-order-component.min.js"></script>
    <!--<script src="aframe-particle-system-component.min.js"></script>-->
    <script type="text/javascript" src="./index.js"></script>
  </head>
  <body>
    <a-scene id="mainScene"
             background="color: #051133"
             render-order="background, earth, object, particles, captions">
      <!--stats>-->
      <a-assets>
        <img id="deepspace" src="data/space-star-background_4873749.png">
        <a-asset-item id="earth" src="data/earth_ball.gltf">
        </a-asset-item>
        <a-asset-item id="chandra" src="data/entire-spacecraft-plus-mirror.glb">
        </a-asset-item>
        <a-asset-item id="nose" src="data/phran-the-photon.glb"></a-asset-item>
      </a-assets>

      <a-sky src="#deepspace"></a-sky>

<!--      <a-cylinder position="970 0 50"
                  rotation="0 0 90"
                  radius="0.5"
                  height="150"
                  color="#FF0000">
      </a-cylinder>
      <a-cylinder position="970 0 50"
                  rotation="0 0 0"
                  radius="0.5"
                  height="150"
                  color="#00FF00">
      </a-cylinder>
      <a-cylinder position="970 0 50"
                  rotation="90 0 0"
                  radius="0.5"
                  height="150"
                  color="#0000FF">
      </a-cylinder>
-->


      <!--<a-draw-curve curveref="#tour1" width="5"
                    material="shader: line; color: red;"></a-draw-curve>-->

      <!--<a-entity clone-along-curve="curve: #tour1; spacing: 0.2; scale:
                                   1 1 1; rotation: 0 0 0;"
                geometry="primitive:box; height:0.1; width:0.2;
                depth:0.1">
      </a-entity>-->


      <a-entity id="tilted-earth"
                rotation="-23 0 0">
        <a-entity position="0 0 0"
                  animation="property: rotation;
                             dur: 2000000;
                             easing: linear;
                             loop: true;
                             to: 0 3600 0">
          <a-entity gltf-model="#earth"
                    scale="1 1 1"
                    position="-7.5 0 16"
                    rotation="0 0 0">
          </a-entity>
        </a-entity>
        <a-entity id="thingy" gltf-model="#chandra" two-sides
                  scale="3 3 3"
                  position="970 -17 50"
                  rotation="0 40 0"
                  render-order="object"
                  opacity="0.9"
                  animation="property: rotation;
                             dur: 1500000;
                             easing: linear;
                             loop: true;
                             to: 0 360 0">
          <!--<a-entity particle-system="color: #FFC800,#000000;
                                     positionSpread: 0.1 0 0.1;
                                     velocitySpread: 0 0 0.1;
                                     velocity: 0 0 0.01;
                                     accelerationSpread: 0 0 0;
                                     texture: ./data/test.png;
                                     size: 0.1;
                                     direction: 1;
                                     rotationAxis: z;
                                     rotationAngle: 90;
                                     type: 1"
                    visible="true"
                    position="-13.8 0.0 -0.07"
                    rotation="0 0 26.5"
                    render-order="particles">
          </a-entity>-->
           <!--<a-box position="0 0 0" width="0.1" height="0.1" depth="0.1"
                 color="#111111" rept="N: 3 3 5;"></a-box>-->
           <a-curve id="preOrbit">
             <a-curve-point position="-1 -0.6 1.5"></a-curve-point>
             <a-curve-point position="-1 -0.5 1.5"></a-curve-point>
           </a-curve>
          <a-curve id="tour6">
             <a-curve-point position="-1 -0.5 1.5"></a-curve-point>
             <a-curve-point position="1.75 -1.6 1.5"></a-curve-point>
             <a-curve-point position="1.75 -1.6 -1.5"></a-curve-point>
             <a-curve-point position="-1 -1.1 -1.5"></a-curve-point>
             <a-curve-point position="-0.75 -1.1 1.5"></a-curve-point>
             <a-curve-point position="0.75 -1.1 1.5"></a-curve-point>
          </a-curve>
          <a-curve id="tour1">
            <a-curve-point position="0.75 -1.1 1.5"></a-curve-point>
            <a-curve-point position="-0.75 0.9 0"></a-curve-point>
            <a-curve-point position="-2 -1.6 0"></a-curve-point>
            <a-curve-point position="-0.5 -1.4 0"></a-curve-point>
            <a-curve-point position="-0.25 -1.5 0"></a-curve-point>
            <a-curve-point position="-0.25 -1.6 0"></a-curve-point>
          </a-curve>
          <a-curve id="tour2">
            <a-curve-point position="-0.25 -1.6 0"></a-curve-point>
            <a-curve-point position="0.25 -1.6 0"></a-curve-point>
          </a-curve>
          <a-curve id="tour3">
            <a-curve-point position="0.5 -1.6 0"></a-curve-point>
            <a-curve-point position="0.75 -1.6 0"></a-curve-point>
            <a-curve-point position="1 -1.6 0"></a-curve-point>
            <a-curve-point position="2 -1.6 0"></a-curve-point>
            <a-curve-point position="2 -1.2 0.2"></a-curve-point>
            <a-curve-point position="1.65 -1.2 0.2"></a-curve-point>
            <a-curve-point position="1.2 -1.2 0.2"></a-curve-point>
            <a-curve-point position="0.5 -1.2 0.2"></a-curve-point>
            <a-curve-point position="0 -1.0 0.2"></a-curve-point>
            <a-curve-point position="-0.5 -0.8 0.2"></a-curve-point>
            <a-curve-point position="-1.0 -0.6 1.5"></a-curve-point>
          </a-curve>
          <a-curve id="tour4">
            <a-curve-point position="-1.0 -0.6 1.5"></a-curve-point>
            <a-curve-point position="-0.5 -1.4 0.2"></a-curve-point>
            <a-curve-point position="-0.3 -1.9 .15"></a-curve-point>
          </a-curve>
          <a-curve id="tour5">
            <a-curve-point position="-0.3 -1.9 .15"></a-curve-point>
            <a-curve-point position="-0.5 -2.1 -.4"></a-curve-point>
          </a-curve>
          <a-curve id="tour7">
            <a-curve-point position="-0.5 -2.1 -.4"></a-curve-point>
             <a-curve-point position="-1 -1.6 1.5"></a-curve-point>
             <a-curve-point position="1.75 -1.6 1.5"></a-curve-point>
             <a-curve-point position="1.75 -1.6 -1.5"></a-curve-point>
             <a-curve-point position="-1 -1.1 -1.5"></a-curve-point>
             <a-curve-point position="-0.75 -1.1 1.5"></a-curve-point>
             <a-curve-point position="-1 -0.5 1.5"></a-curve-point>
          </a-curve>
          <a-entity id="textHolder"
                    position="0 0 0"
                    opacity="0.9"
                    render-order="captions"
                    text="width: 0.5; color: white; align: center;
                          anchor: center; side: double;
                          value: *">
          </a-entity>
          <a-entity id="mainCameraRig"
                    alongpathevent
                    alongpath="curve: #preOrbit; loop: false; dur: 1000;">
            <a-entity camera
                      id="mainCamera"
                      position="0 1.6 0"
                      rotation="0 0 0"
                      look-controls="pointerLockEnabled: true">
              <!--<a-entity cursor
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03;"
                  material="color: #CCC; opacity: 0.1; shader: flat;"></a-entity>
                  </a-entity>-->
            </a-entity>
          </a-entity>
        </a-entity>
      </a-entity>

    </a-scene>
    <div id="splash">
      <div id="splash-inner">
        <div class="title">The Chandra X-Ray</div>
      <div class="sub-title">Observatory</div>
      <div id="go-button" onclick="pressStart()" style="display: none;">Start</div>
      <!--<div id="go-button-silent" onclick="pressSilentStart()">(Silent)</div>-->
      <div class="sub-title">VR by <a href="https://www.nasa.gov/">NASA</a>,
        <a href="http://chandra.harvard.edu/">Chandra</a>, <br>
        <a href="https://www.cfa.harvard.edu/sao">SAO</a> &
        <a href="http://cs.brown.edu/people/faculty/tsgouros/">Brown CS</a></div>
      <br />
    </div>
  </div>
  <script type="text/javascript">
    // This stuff is down here at the end because it has to run as soon as
    // all the a-frame assets are loaded.  It manages the splash screen shown
    // above, by pausing the action as soon as everything is loaded, and then by
    // executing .play() when the start button is pressed.

    // Pause action as soon as everything is loaded.
    document.getElementById("mainScene").addEventListener("loaded",
      function() {
        document.getElementById('mainCamera').pause();
        document.getElementById("go-button").style.display = "flex";
    });

    pressStart = function() {
      document.getElementById("splash").style.display = "none";
      document.getElementById("go-button").style.display = "none";
      /*document.getElementById("go-button-silent").style.display = "none";*/
      document.getElementById("mainCamera").play();

      // Load all the sounds and play-then-pause them all, to get them
      // permission to run under the iOS rules.
      var sounds = document.getElementsByTagName('audio');

      for (i = 0; i < sounds.length; i++) {
        console.log("playing, then pausing:", sounds[i]);
        sounds[i].play(); sounds[i].pause();
      };
    }

    pressSilentStart = function() {
      document.getElementById("splash").style.display = "none";
      document.getElementById("go-button").style.display = "none";
      /* Not exactly sure how to signal that we want it silent. */
      /* document.getElementById("go-button-silent").style.display = "none"; */
      document.getElementById("mainCamera").play();
    }
    </script>
  <!--<script type="text/javascript" src="./post.js"></script>-->
  </body>
</html>
